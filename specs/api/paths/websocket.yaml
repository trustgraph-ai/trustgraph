get:
  tags:
    - WebSocket
  summary: WebSocket - multiplexed service interface
  description: |
    WebSocket interface for multiplexed access to all services.

    ## WebSocket Overview

    Single WebSocket connection for all operations:
    - **Multiplexed**: Multiple concurrent requests
    - **Bidirectional**: Request/response and streaming
    - **Efficient**: Reduced overhead vs HTTP
    - **Real-time**: Low latency communication

    ## Connection

    Establish WebSocket connection:
    ```
    ws://localhost:8088/api/v1/socket
    ```

    Or for specific flow:
    ```
    ws://localhost:8088/api/v1/flow/{flow}/socket
    ```

    ## Message Protocol

    Messages are JSON with request ID for multiplexing:

    ### Request Message
    ```json
    {
      "id": "req-123",
      "service": "agent",
      "request": {
        "question": "What is quantum computing?",
        "streaming": true
      }
    }
    ```

    ### Response Message
    ```json
    {
      "id": "req-123",
      "response": {
        "chunk-type": "answer",
        "content": "Quantum computing uses...",
        "end-of-dialog": false
      }
    }
    ```

    ### Error Message
    ```json
    {
      "id": "req-123",
      "error": {
        "type": "SERVICE_ERROR",
        "message": "Flow not found"
      }
    }
    ```

    ## Multiplexing

    Send multiple requests concurrently:
    - Each request has unique ID
    - Responses include matching ID
    - No head-of-line blocking

    ## Streaming

    Streaming services send multiple responses:
    - Same request ID
    - Progressive results
    - Completion indicated by flag

    ## Services

    All REST services available via WebSocket:
    - Global services (config, flow, librarian, knowledge, collection-management)
    - Flow services (agent, RAG, embeddings, queries, etc.)
    - Same request/response formats as REST

    ## Authentication

    Include bearer token in connection:
    - As query parameter: `?token=<token>`
    - Or in WebSocket subprotocol header

    ## Benefits

    - Lower latency than HTTP
    - Connection reuse
    - Server push capabilities
    - Efficient for real-time applications

  operationId: websocketConnection
  security:
    - bearerAuth: []
  parameters:
    - name: Upgrade
      in: header
      required: true
      schema:
        type: string
        enum: [websocket]
      description: WebSocket upgrade header
    - name: Connection
      in: header
      required: true
      schema:
        type: string
        enum: [Upgrade]
      description: Connection upgrade header
  responses:
    '101':
      description: Switching Protocols - WebSocket connection established
    '401':
      $ref: '../components/responses/Unauthorized.yaml'
    '500':
      $ref: '../components/responses/Error.yaml'
